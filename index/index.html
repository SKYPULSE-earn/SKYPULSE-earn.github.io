<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SkyPulse</title>
  <style>
    :root{
      --bg:#0a0e27;
      --panel:#1a1f3a;
      --panel2: rgba(255,255,255,.06);
      --border: rgba(255,255,255,.12);
      --text:#f0f4f8;
      --muted:#8b92a9;
      --primary:#3b82f6;
      --success:#10b981;
      --danger:#ef4444;
      --shadow: 0 20px 60px rgba(0,0,0,.5);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,sans-serif}
    body{
      display:flex;align-items:center;justify-content:center;
      background-image:
        radial-gradient(600px 400px at 20% 10%, rgba(59,130,246,0.15), transparent 50%),
        radial-gradient(600px 400px at 80% 90%, rgba(16,185,129,0.10), transparent 50%);
      overflow:hidden;
    }

    .app{
      width:min(980px, 96vw);
      height:min(620px, 92vh);
      display:grid;
      grid-template-columns: 1fr 320px;
      gap:16px;
      padding:16px;
    }
    @media (max-width: 900px){
      .app{grid-template-columns:1fr; height:auto}
      .right{order:-1}
    }

    .card{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    /* Game panel */
    .game-header{
      display:flex;align-items:center;justify-content:space-between;
      padding:14px 16px;
      background:rgba(0,0,0,.14);
      border-bottom:1px solid var(--border);
    }
    .brand{
      display:flex;align-items:center;gap:10px;font-weight:900;letter-spacing:-0.5px;
    }
    .brand .logo{font-size:18px}
    .brand .name{font-size:15px}
    .hud{
      display:flex;align-items:center;gap:10px;
      font-size:12px;color:var(--muted);font-weight:800;
    }
    .pill{
      padding:6px 10px;border-radius:999px;background:var(--panel2);
      border:1px solid var(--border);
      color:var(--text);
    }
    .btn-icon{
      width:38px;height:38px;border-radius:12px;
      border:1px solid var(--border);background:var(--panel2);
      color:var(--text);cursor:pointer;
      display:flex;align-items:center;justify-content:center;
      transition:.15s;
      font-size:16px;
    }
    .btn-icon:hover{transform:translateY(-1px);background:rgba(255,255,255,.09)}
    .canvas-wrap{
      position:relative;
      height: calc(100% - 57px);
      display:flex;align-items:center;justify-content:center;
      padding:14px;
    }
    canvas{
      width:100%;
      height:100%;
      max-height:520px;
      border-radius:14px;
      background: linear-gradient(180deg, rgba(59,130,246,.18), rgba(16,185,129,.10));
      border:1px solid var(--border);
      display:block;
    }
    .overlay{
      position:absolute;inset:14px;
      display:flex;align-items:center;justify-content:center;
      pointer-events:none;
    }
    .overlay .panel{
      pointer-events:none;
      width:min(440px, 92%);
      text-align:center;
      background:rgba(10,14,39,.84);
      border:1px solid var(--border);
      border-radius:16px;
      padding:18px 16px;
      backdrop-filter: blur(10px);
    }
    .title{font-size:18px;font-weight:900;margin-bottom:8px}
    .subtitle{font-size:13px;color:var(--muted);line-height:1.35}
    .kbd{
      display:inline-flex;gap:8px;align-items:center;justify-content:center;
      margin-top:12px;
      font-size:12px;color:var(--muted)
    }
    .kbd span{
      border:1px solid var(--border);
      background:rgba(255,255,255,.06);
      border-radius:8px;
      padding:6px 10px;
      color:var(--text);
      font-weight:900;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    }

    /* Right panel */
    .right{display:flex;flex-direction:column;gap:12px}
    .panel-title{
      padding:12px 14px;
      font-size:12px;
      font-weight:900;
      letter-spacing:1px;
      text-transform:uppercase;
      color:var(--muted);
      border-bottom:1px solid var(--border);
      background:rgba(0,0,0,.12);
    }
    .panel-body{padding:14px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 0;border-bottom:1px solid var(--border)}
    .row:last-child{border-bottom:none}
    .label{font-size:13px;font-weight:900}
    .value{font-size:12px;color:var(--muted);font-weight:800}

    .btn{
      width:100%;
      border:0;
      border-radius:12px;
      background:linear-gradient(135deg,var(--primary),#1d4ed8);
      color:white;
      font-weight:900;
      padding:12px 14px;
      cursor:pointer;
      transition:.15s;
      display:flex;align-items:center;justify-content:center;gap:10px;
    }
    .btn:hover{transform:translateY(-1px);box-shadow:0 12px 30px rgba(59,130,246,.35)}
    .btn.secondary{
      background:var(--panel2);
      border:1px solid var(--border);
      color:var(--text);
      box-shadow:none;
    }
    .btn.secondary:hover{background:rgba(255,255,255,.09);transform:translateY(-1px)}
    .small{font-size:12px;color:var(--muted);line-height:1.4;margin-top:10px}

    /* Modal (Settings) */
    .modal{
      position:fixed;inset:0;
      display:none;align-items:center;justify-content:center;
      background:rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      z-index:1000;
      padding:16px;
    }
    .modal.show{display:flex}
    .modal-card{
      width:min(760px, 96vw);
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .modal-head{
      display:flex;align-items:center;justify-content:space-between;
      padding:12px 14px;
      border-bottom:1px solid var(--border);
      background:rgba(0,0,0,.14);
    }
    .tabs{
      display:flex;gap:6px;
      padding:10px 14px;
      border-bottom:1px solid var(--border);
      background:rgba(255,255,255,.03);
    }
    .tab{
      padding:8px 10px;border-radius:10px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.05);
      color:var(--muted);
      font-weight:900;font-size:12px;
      cursor:pointer;
      transition:.15s;
    }
    .tab.active{
      background:rgba(59,130,246,.18);
      color:var(--text);
      border-color:rgba(59,130,246,.35);
    }
    .modal-body{padding:14px}
    .section{display:none}
    .section.active{display:block}
    .toggle{
      width:48px;height:26px;border-radius:999px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.06);
      position:relative;cursor:pointer;transition:.15s;
      flex:0 0 auto;
    }
    .toggle::after{
      content:"";
      position:absolute;top:2px;left:2px;
      width:22px;height:22px;border-radius:50%;
      background:white;transition:.15s;
    }
    .toggle.on{background:rgba(59,130,246,.35);border-color:rgba(59,130,246,.55)}
    .toggle.on::after{left:24px}
    .select{
      width:100%;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.25);
      color:var(--text);
      font-weight:900;
      outline:none;
    }
    .hr{height:1px;background:var(--border);margin:12px 0}
    .earnpro-box{
      border:1px solid rgba(59,130,246,.35);
      background:rgba(59,130,246,.12);
      border-radius:14px;
      padding:12px;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
    }
    .earnpro-box .left{
      display:flex;flex-direction:column;gap:4px;
    }
    .earnpro-box .left b{font-size:13px}
    .earnpro-box .left span{font-size:12px;color:var(--muted);line-height:1.3}
    .earnpro-btn{
      padding:10px 12px;border-radius:12px;border:0;
      background:linear-gradient(135deg,var(--primary),#1d4ed8);
      color:white;font-weight:900;cursor:pointer;white-space:nowrap;
      transition:.15s;
    }
    .earnpro-btn:hover{transform:translateY(-1px);box-shadow:0 12px 30px rgba(59,130,246,.25)}
  </style>
</head>
<body>
  <div class="app">
    <!-- Game -->
    <div class="card">
      <div class="game-header">
        <div class="brand">
          <span class="logo">⚡</span>
          <span class="name">SkyPulse</span>
        </div>
        <div class="hud">
          <span class="pill">Score: <span id="score">0</span></span>
          <span class="pill">Best: <span id="best">0</span></span>
          <button class="btn-icon" id="settingsBtn" title="Settings">⚙️</button>
        </div>
      </div>
      <div class="canvas-wrap">
        <canvas id="game" width="900" height="520"></canvas>
        <div class="overlay" id="overlay">
          <div class="panel">
            <div class="title" id="overlayTitle">Tap to start</div>
            <div class="subtitle" id="overlaySubtitle">
              Fly through the gates. Don’t hit the ground or pipes.
            </div>
            <div class="kbd">
              <span>Space</span> <span>Click</span> <span>Tap</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right panel -->
    <div class="right">
      <div class="card">
        <div class="panel-title">Quick Controls</div>
        <div class="panel-body">
          <button class="btn" id="playBtn">▶️ Play / Restart</button>
          <div style="height:10px"></div>
          <button class="btn secondary" id="pauseBtn">⏸️ Pause</button>
          <div class="small">
            Tip: Use <b>Space</b> to boost.
          </div>
        </div>
      </div>

      <div class="card">
        <div class="panel-title">Stats</div>
        <div class="panel-body">
          <div class="row">
            <div class="label">Gates passed</div>
            <div class="value"><span id="pipesPassed">0</span></div>
          </div>
          <div class="row">
            <div class="label">Attempts</div>
            <div class="value"><span id="attempts">0</span></div>
          </div>
          <div class="row">
            <div class="label">Mode</div>
            <div class="value"><span id="modeLabel">Normal</span></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings modal -->
  <div class="modal" id="settingsModal" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-head">
        <div class="brand" style="gap:10px">
          <span class="logo">⚙️</span>
          <span class="name">Settings</span>
        </div>
        <button class="btn-icon" id="closeSettings" title="Close">✕</button>
      </div>

      <div class="tabs">
        <button class="tab active" data-tab="gameplay">Gameplay</button>
        <button class="tab" data-tab="more">More</button>
      </div>

      <div class="modal-body">
        <div class="section active" id="tab-gameplay">
          <div class="row">
            <div>
              <div class="label">Hard Mode</div>
              <div class="value">Smaller gaps + faster gates</div>
            </div>
            <div class="toggle" id="hardToggle" role="switch" aria-checked="false"></div>
          </div>

          <div class="row">
            <div>
              <div class="label">Style</div>
              <div class="value">Clean or neon</div>
            </div>
            <select class="select" id="gfxSelect" style="max-width: 220px;">
              <option value="clean" selected>Clean</option>
              <option value="neon">Neon</option>
            </select>
          </div>

          <div class="hr"></div>
          <div class="small">
            Best score is saved locally on this device.
          </div>
        </div>

        <div class="section" id="tab-more">
          <div class="earnpro-box">
            <div class="left">
              <b>EarnPro</b>
              <span>Open the EarnPro app (login required).</span>
            </div>
            <button class="earnpro-btn" id="earnproBtn">EarnPro</button>
          </div>

          <div class="hr"></div>

          <div class="small">
            EarnPro remains exactly the same as your current file — we’re only linking to it here.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // -------------------------
    // SkyPulse (Flappy-style) game
    // -------------------------
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    // UI
    const scoreEl = document.getElementById('score');
    const bestEl = document.getElementById('best');
    const pipesPassedEl = document.getElementById('pipesPassed');
    const attemptsEl = document.getElementById('attempts');
    const modeLabelEl = document.getElementById('modeLabel');

    const overlay = document.getElementById('overlay');
    const overlayTitle = document.getElementById('overlayTitle');
    const overlaySubtitle = document.getElementById('overlaySubtitle');

    // Settings modal
    const settingsBtn = document.getElementById('settingsBtn');
    const settingsModal = document.getElementById('settingsModal');
    const closeSettings = document.getElementById('closeSettings');
    const tabs = Array.from(document.querySelectorAll('.tab'));
    const sections = {
      gameplay: document.getElementById('tab-gameplay'),
      more: document.getElementById('tab-more'),
    };

    const hardToggle = document.getElementById('hardToggle');
    const gfxSelect = document.getElementById('gfxSelect');
    const earnproBtn = document.getElementById('earnproBtn');

    // Buttons
    const playBtn = document.getElementById('playBtn');
    const pauseBtn = document.getElementById('pauseBtn');

    // Storage
    const STORE_KEY = 'skypulse:v1';
    const store = {
      load(){ try { return JSON.parse(localStorage.getItem(STORE_KEY) || '{}'); } catch { return {}; } },
      save(v){ localStorage.setItem(STORE_KEY, JSON.stringify(v)); }
    };
    const saved = store.load();

    // Settings state
    const settings = {
      hard: !!saved.hard,
      gfx: saved.gfx || 'clean',
    };

    function syncSettingsUI(){
      hardToggle.classList.toggle('on', settings.hard);
      hardToggle.setAttribute('aria-checked', settings.hard ? 'true' : 'false');
      gfxSelect.value = settings.gfx;
      modeLabelEl.textContent = settings.hard ? 'Hard' : 'Normal';
    }
    function persist(){
      store.save({ ...store.load(), hard: settings.hard, gfx: settings.gfx, best });
    }

    // Game state
    let running = false;
    let paused = false;
    let startedOnce = false;

    let score = 0;
    let best = Number(saved.best || 0);
    let attempts = Number(saved.attempts || 0);
    let pipesPassed = 0;

    bestEl.textContent = best;
    attemptsEl.textContent = attempts;
    pipesPassedEl.textContent = pipesPassed;

    const WORLD = {
      g: 0.52,
      flap: -9.2,
      speed: 3.4,
      pipeW: 74,
      gap: 155,
      spawnEvery: 1350, // ms
      groundH: 68
    };

    function applyDifficulty(){
      if (settings.hard){
        WORLD.speed = 4.35;
        WORLD.gap = 130;
        WORLD.flap = -9.6;
        WORLD.spawnEvery = 1250;
      } else {
        WORLD.speed = 3.4;
        WORLD.gap = 155;
        WORLD.flap = -9.2;
        WORLD.spawnEvery = 1350;
      }
    }

    const bird = { x: 210, y: canvas.height * 0.44, r: 16, vy: 0 };
    let pipes = [];
    let lastSpawn = 0;
    let lastTs = 0;

    function resetGame(){
      applyDifficulty();
      running = false;
      paused = false;
      score = 0;
      pipesPassed = 0;
      bird.y = canvas.height * 0.44;
      bird.vy = 0;
      pipes = [];
      lastSpawn = 0;
      lastTs = 0;

      scoreEl.textContent = '0';
      pipesPassedEl.textContent = '0';

      overlay.style.display = 'flex';
      overlayTitle.textContent = startedOnce ? 'Tap to restart' : 'Tap to start';
      overlaySubtitle.textContent = 'Click / tap / Space to boost. Avoid gates & ground.';
      pauseBtn.textContent = '⏸️ Pause';
    }

    function startRun(){
      if (running) return;
      running = true;
      paused = false;
      startedOnce = true;
      overlay.style.display = 'none';
      attempts++;
      attemptsEl.textContent = attempts;
      store.save({ ...store.load(), attempts, best, hard: settings.hard, gfx: settings.gfx });
      requestAnimationFrame(loop);
    }

    function togglePause(){
      if (!running) return;
      paused = !paused;
      pauseBtn.textContent = paused ? '▶️ Resume' : '⏸️ Pause';
      if (!paused) requestAnimationFrame(loop);
    }

    function flap(){
      if (!running) startRun();
      if (paused) return;
      bird.vy = WORLD.flap;
    }

    function spawnPipe(){
      const topMin = 40;
      const topMax = canvas.height - WORLD.groundH - WORLD.gap - 40;
      const topH = Math.floor(topMin + Math.random() * (topMax - topMin));
      pipes.push({ x: canvas.width + 20, topH, passed: false });
    }

    function rectCircleCollide(rx, ry, rw, rh, cx, cy, cr){
      const nx = Math.max(rx, Math.min(cx, rx + rw));
      const ny = Math.max(ry, Math.min(cy, ry + rh));
      const dx = cx - nx;
      const dy = cy - ny;
      return (dx*dx + dy*dy) <= cr*cr;
    }

    function die(){
      running = false;
      overlay.style.display = 'flex';
      overlayTitle.textContent = 'Game Over';
      overlaySubtitle.textContent = 'Tap to try again.';
      if (score > best){
        best = score;
        bestEl.textContent = best;
      }
      store.save({ ...store.load(), best, attempts, hard: settings.hard, gfx: settings.gfx });
    }

    function drawBackground(){
      ctx.clearRect(0,0,canvas.width,canvas.height);

      ctx.globalAlpha = 0.22;
      for (let i=0;i<50;i++){
        const x = (i*73) % canvas.width;
        const y = (i*137) % (canvas.height - WORLD.groundH);
        ctx.fillStyle = '#fff';
        ctx.fillRect(x, y, 2, 2);
      }
      ctx.globalAlpha = 1;

      ctx.fillStyle = 'rgba(0,0,0,0.25)';
      ctx.fillRect(0, canvas.height - WORLD.groundH, canvas.width, WORLD.groundH);

      ctx.globalAlpha = 0.25;
      for (let x=0; x<canvas.width; x+=32){
        ctx.fillStyle = 'rgba(255,255,255,0.12)';
        ctx.fillRect(x, canvas.height - WORLD.groundH + 18, 18, 6);
      }
      ctx.globalAlpha = 1;
    }

    function drawPipes(){
      const pipeColor = settings.gfx === 'neon' ? 'rgba(59,130,246,0.95)' : 'rgba(16,185,129,0.92)';
      const pipeEdge = settings.gfx === 'neon' ? 'rgba(59,130,246,0.30)' : 'rgba(16,185,129,0.25)';
      for (const p of pipes){
        ctx.fillStyle = pipeColor;
        ctx.fillRect(p.x, 0, WORLD.pipeW, p.topH);

        const bottomY = p.topH + WORLD.gap;
        const bottomH = (canvas.height - WORLD.groundH) - bottomY;
        ctx.fillRect(p.x, bottomY, WORLD.pipeW, bottomH);

        ctx.strokeStyle = pipeEdge;
        ctx.lineWidth = 3;
        ctx.strokeRect(p.x+1, 1, WORLD.pipeW-2, p.topH-2);
        ctx.strokeRect(p.x+1, bottomY+1, WORLD.pipeW-2, bottomH-2);
      }
    }

    function drawBird(){
      const body = settings.gfx === 'neon' ? 'rgba(245,158,11,0.95)' : 'rgba(240,244,248,0.92)';
      ctx.beginPath();
      ctx.fillStyle = body;
      ctx.arc(bird.x, bird.y, bird.r, 0, Math.PI*2);
      ctx.fill();

      ctx.globalAlpha = 0.25;
      ctx.beginPath();
      ctx.fillStyle = '#000';
      ctx.ellipse(bird.x - 4, bird.y + 2, 10, 7, 0.25, 0, Math.PI*2);
      ctx.fill();
      ctx.globalAlpha = 1;

      ctx.beginPath();
      ctx.fillStyle = '#0b102a';
      ctx.arc(bird.x + 5, bird.y - 4, 3, 0, Math.PI*2);
      ctx.fill();

      ctx.beginPath();
      ctx.fillStyle = 'rgba(239,68,68,0.95)';
      ctx.moveTo(bird.x + bird.r, bird.y);
      ctx.lineTo(bird.x + bird.r + 12, bird.y - 5);
      ctx.lineTo(bird.x + bird.r + 12, bird.y + 5);
      ctx.closePath();
      ctx.fill();
    }

    function loop(ts){
      if (!running || paused) return;

      if (!lastTs) lastTs = ts;
      const dt = ts - lastTs;
      lastTs = ts;

      if (!lastSpawn) lastSpawn = ts;
      if (ts - lastSpawn >= WORLD.spawnEvery){
        spawnPipe();
        lastSpawn = ts;
      }

      bird.vy += WORLD.g * (dt / 16.67);
      bird.y += bird.vy * (dt / 16.67);

      const sp = WORLD.speed * (dt / 16.67);
      for (const p of pipes){
        p.x -= sp;
        if (!p.passed && p.x + WORLD.pipeW < bird.x){
          p.passed = true;
          score++;
          pipesPassed++;
          scoreEl.textContent = String(score);
          pipesPassedEl.textContent = String(pipesPassed);
        }
      }
      pipes = pipes.filter(p => p.x + WORLD.pipeW > -40);

      const groundY = canvas.height - WORLD.groundH;
      if (bird.y + bird.r >= groundY) return die();
      if (bird.y - bird.r <= 0) return die();

      for (const p of pipes){
        if (rectCircleCollide(p.x, 0, WORLD.pipeW, p.topH, bird.x, bird.y, bird.r)) return die();
        const bottomY = p.topH + WORLD.gap;
        const bottomH = groundY - bottomY;
        if (rectCircleCollide(p.x, bottomY, WORLD.pipeW, bottomH, bird.x, bird.y, bird.r)) return die();
      }

      drawBackground();
      drawPipes();
      drawBird();

      requestAnimationFrame(loop);
    }

    // Input
    window.addEventListener('keydown', (e) => {
      if (e.code === 'Space'){
        e.preventDefault();
        flap();
      }
      if (e.code === 'KeyP') togglePause();
      if (e.code === 'KeyR') { resetGame(); startRun(); }
    });
    canvas.addEventListener('pointerdown', () => flap());
    overlay.addEventListener('pointerdown', () => { if (!running) { resetGame(); startRun(); } });

    playBtn.addEventListener('click', () => { resetGame(); startRun(); });
    pauseBtn.addEventListener('click', () => togglePause());

    // Settings modal behavior
    function openSettings(){ settingsModal.classList.add('show'); }
    function closeSettingsModal(){ settingsModal.classList.remove('show'); }

    settingsBtn.addEventListener('click', openSettings);
    closeSettings.addEventListener('click', closeSettingsModal);
    settingsModal.addEventListener('click', (e) => { if (e.target === settingsModal) closeSettingsModal(); });

    tabs.forEach(t => {
      t.addEventListener('click', () => {
        tabs.forEach(x => x.classList.remove('active'));
        t.classList.add('active');
        const tab = t.dataset.tab;
        Object.entries(sections).forEach(([k, el]) => el.classList.toggle('active', k === tab));
      });
    });

    hardToggle.addEventListener('click', () => {
      settings.hard = !settings.hard;
      applyDifficulty();
      syncSettingsUI();
      persist();
      if (running){
        // Restart cleanly after mode change
        running = false;
        overlay.style.display = 'flex';
        overlayTitle.textContent = 'Mode changed';
        overlaySubtitle.textContent = 'Tap to restart with new settings.';
      }
    });

    gfxSelect.addEventListener('change', () => {
      settings.gfx = gfxSelect.value;
      syncSettingsUI();
      persist();
    });

    // ✅ EarnPro button: goes to your untouched EarnPro page
    earnproBtn.addEventListener('click', () => {
      window.location.href = "earnpro.html"; // put your existing EarnPro file as earnpro.html
    });

    // Init
    syncSettingsUI();
    resetGame();
  </script>
</body>
</html>
